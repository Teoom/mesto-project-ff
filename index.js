(()=>{"use strict";function e(e,t,o,a){const n=e.querySelector(".places__item").cloneNode(!0),r=n.querySelector(".card__image"),l=n.querySelector(".card__title"),s=n.querySelector(".card__like-button"),i=n.querySelector(".card__delete-button"),d=n.querySelector(".card__like-count");return r.src=t.link,r.alt=t.name,r.addEventListener("click",(()=>{o.openPopupImage(t.link,t.name)})),l.textContent=t.name,t.owner._id!==a&&a?i.style.display="none":i.addEventListener("click",(()=>{o.deleteCard(t._id).then((()=>{n.remove()})).catch((e=>{console.log(e)}))})),t.likes.length&&t.likes.forEach((e=>{e._id===a&&s.classList.add("card__like-button_is-active")})),s.addEventListener("click",(()=>{s.classList.contains("card__like-button_is-active")?o.deleteLike(t._id).then((e=>{s.classList.remove("card__like-button_is-active"),d.textContent=e.likes.length})).catch((e=>{console.log(e)})):o.putLike(t._id).then((e=>{s.classList.add("card__like-button_is-active"),d.textContent=e.likes.length})).catch((e=>{console.log(e)}))})),d.textContent=t.likes.length,n}const t={element:"",openModal(e){e.classList.remove("popup_is-animated"),e.classList.add("popup_is-opened"),t.element=e,e.addEventListener("mousedown",t.overlayCloseModal),e.querySelector(".popup__close").addEventListener("click",t.closeModal),document.body.addEventListener("keydown",t.keyCloseModal)},closeModal(){t.element.classList.remove("popup_is-opened"),t.element.classList.add("popup_is-animated");const e=t.element.querySelector(".popup__close");t.element.removeEventListener("mousedown",t.overlayCloseModal),e.removeEventListener("click",t.closeModal),document.body.removeEventListener("keydown",t.keyCloseModal)},keyCloseModal(e){"Escape"===e.key&&t.closeModal()},overlayCloseModal(e){e.target.classList.contains("popup")&&t.closeModal()},getFormElements:e=>[...e.elements].reduce(((e,t)=>(e[t.name]=t,e)),{})},o={validationConfig:{},enableValidation(e){o.validationConfig=e,[...document.querySelectorAll(o.validationConfig.formSelector)].forEach((e=>{const t=[...e.querySelectorAll(o.validationConfig.inputSelector)];o.toggleButtonState(e,t),t.forEach((a=>{a.addEventListener("input",(()=>{o.toggleButtonState(e,t),o.checkInputValidity(e,a)}))}))}))},toggleButtonState(e,t){const a=e.querySelector(o.validationConfig.submitButtonSelector);o.hasInvalidInput(t)?(a.classList.add(o.validationConfig.inactiveButtonClass),a.disabled=!0):(a.classList.remove(o.validationConfig.inactiveButtonClass),a.disabled=!1)},hasInvalidInput:e=>e.some((e=>!e.validity.valid)),checkInputValidity(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||""):t.setCustomValidity(""),t.validity.valid?o.hideInputError(e,t):o.showInputError(e,t,t.validationMessage)},showInputError(e,t,a){const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.validationConfig.inputErrorClass),n.textContent=a,n.classList.add(o.validationConfig.errorClass)},hideInputError(e,t){const a=e.querySelector(`.${t.id}-error`);t.classList.remove(o.validationConfig.inputErrorClass),a.classList.remove(o.validationConfig.errorClass),a.textContent=""},clearValidation(e){const t=[...e.querySelectorAll(o.validationConfig.inputSelector)];t.forEach((t=>{t.setCustomValidity(""),o.hideInputError(e,t)})),o.toggleButtonState(e,t)}},a={baseUrl:"https://nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"380f7e30-cdfc-4c3d-9a2a-a8caae145324","Content-Type":"application/json"}},n=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),r={getServerData:()=>Promise.all([fetch(`${a.baseUrl}/users/me`,{headers:a.headers}).then((e=>n(e))),fetch(`${a.baseUrl}/cards`,{headers:a.headers}).then((e=>n(e)))]),editUserInfo:e=>fetch(`${a.baseUrl}/users/me`,{method:"PATCH",headers:a.headers,body:JSON.stringify(e)}).then((e=>n(e))),editUserImage:e=>fetch(`${a.baseUrl}/users/me/avatar`,{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:e})}).then((e=>n(e))),addCard:e=>fetch(`${a.baseUrl}/cards`,{method:"POST",headers:a.headers,body:JSON.stringify(e)}).then((e=>n(e))),deleteCard:e=>fetch(`${a.baseUrl}/cards/${e}`,{method:"DELETE",headers:a.headers}).then((e=>n(e))),putLike:e=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:a.headers}).then((e=>n(e))),deleteLike:e=>fetch(`${a.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:a.headers}).then((e=>n(e)))},l=document.querySelector(".places__list"),s=document.querySelector("#card-template").content,i={putLike:r.putLike,deleteLike:r.deleteLike,deleteCard:r.deleteCard,openPopupImage(e,t){const o=document.querySelector(".popup_type_image "),a=o.querySelector(".popup__image"),n=o.querySelector(".popup__caption");a.src=e,a.alt=t,n.textContent=t,d(o)}},{openModal:d,closeModal:c,getFormElements:u}=t,{enableValidation:p,clearValidation:m}=o,_=document.querySelector(".profile__add-button"),h=document.querySelector(".popup_type_new-card"),v=h.querySelector(".popup__form"),y=v.querySelector(".popup__button");_.addEventListener("click",(()=>{v.reset(),m(v),d(h)})),v.addEventListener("submit",(t=>{t.preventDefault(),y.textContent="Сохраняем...";const o=u(v),a={name:o["place-name"].value,link:o.link.value};r.addCard(a).then((t=>{l.prepend(e(s,t,i)),c()})).catch((e=>{console.log(e)})).finally((()=>{y.textContent="Сохранить"}))}));const C=document.querySelector(".profile__edit-button"),g=document.querySelector(".popup_type_edit"),f=g.querySelector(".popup__form"),S=f.querySelector(".popup__button"),k=document.querySelector(".profile__title"),b=document.querySelector(".profile__description");C.addEventListener("click",(()=>{const{name:e,description:t}=u(f);e.value=k.textContent,t.value=b.textContent,m(f),d(g)})),f.addEventListener("submit",(e=>{e.preventDefault(),S.textContent="Сохранение...";const{name:t,description:o}=u(f);r.editUserInfo({name:t.value,about:o.value}).then((e=>{k.textContent=e.name,b.textContent=e.about,c()})).catch((e=>{console.log(e)})).finally((()=>{S.textContent="Сохранить"}))}));const L=document.querySelector(".profile__image"),E=document.querySelector(".popup_type_profile-image"),q=E.querySelector(".popup__form"),x=q.querySelector(".popup__button");L.addEventListener("click",(()=>{q.reset(),m(q),d(E)})),q.addEventListener("submit",(e=>{e.preventDefault(),x.textContent="Сохранение...";const{image:t}=u(q);r.editUserImage(t.value).then((e=>{L.style.backgroundImage=`url(${e.avatar})`,c()})).catch((e=>{console.log(e)})).finally((()=>{x.textContent="Сохранить"}))})),p({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),r.getServerData().then((t=>{const[o,a]=t;L.style.backgroundImage=`url(${o.avatar})`,k.textContent=o.name,b.textContent=o.about,a.forEach((t=>{l.append(e(s,t,i,o._id))}))}))})();